<!DOCTYPE html>
<html lang="es-CO">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="color-scheme" content="light" />
  <meta name="theme-color" content="#ffffff" />

  <title>Horarios Grupales ¬∑ Musicala (LIGHT)</title>
  <meta name="description" content="Visor y editor de horarios grupales por d√≠a, hora y sal√≥n." />

  <meta name="robots" content="index,follow" />
  <meta name="format-detection" content="telephone=no" />

  <link rel="icon" href="./logo.png" />
  <link rel="apple-touch-icon" href="./logo.png" />

  <link rel="preconnect" href="https://www.gstatic.com" crossorigin />
  <link rel="preconnect" href="https://firestore.googleapis.com" crossorigin />

  <link rel="preload" href="./styles.css" as="style" />
  <link rel="stylesheet" href="./styles.css" />

  <!-- Preload m√≥dulos (peque√±a ayuda a carga percibida) -->
  <link rel="modulepreload" href="./main.js" />
  <link rel="modulepreload" href="./horarios.core.js" />
  <link rel="modulepreload" href="./firebase.js" />

  <!-- Utilitarios m√≠nimos (no tema, solo soporte) -->
  <style>
    .hidden{ display:none !important; }
    .sr-only{
      position:absolute!important;
      width:1px;height:1px;
      padding:0;margin:-1px;
      overflow:hidden;clip:rect(0,0,0,0);
      white-space:nowrap;border:0;
    }

    /* Skip link */
    .skip-link{
      position:absolute; left:-9999px; top:auto;
      width:1px; height:1px; overflow:hidden;
    }
    .skip-link:focus{
      left:12px; top:12px;
      width:auto; height:auto;
      padding:10px 12px;
      background:#fff;
      border:1px solid rgba(17,24,39,.18);
      border-radius:12px;
      z-index:9999;
      box-shadow: 0 12px 30px rgba(17,24,39,.12);
      outline: none;
    }

    button, .btn, .icon-btn { touch-action: manipulation; }

    .noscript{
      margin: 12px;
      padding: 12px 14px;
      border: 1px solid rgba(17,24,39,.12);
      border-radius: 14px;
      background: #fff;
      color:#111827;
      box-shadow: 0 12px 30px rgba(17,24,39,.06);
    }

    /* Compat: bloque oculto para "Grupo select" + mini modal */
    #group-compat{
      position:absolute;
      left:-9999px; top:auto;
      width:1px; height:1px;
      overflow:hidden;
      opacity:0;
      pointer-events:none;
    }

    /* Modal lite (mini CRUD grupos) */
    .modal-lite{
      position: fixed;
      inset: 0;
      z-index: 9998;
      display: none;
    }
    .modal-lite[aria-hidden="false"]{ display:block; }
    .modal-lite__backdrop{
      position:absolute; inset:0;
      background: rgba(0,0,0,.22);
    }
    .modal-lite__card{
      position: relative;
      width: min(560px, calc(100vw - 24px));
      margin: 40px auto;
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 24px 70px rgba(17,24,39,.22);
      border: 1px solid rgba(17,24,39,.10);
      overflow:hidden;
    }
    .modal-lite__header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 14px 16px;
      border-bottom: 1px solid rgba(17,24,39,.08);
      background: rgba(255,255,255,.92);
      backdrop-filter: blur(10px);
    }
    .modal-lite__body{ padding: 14px 16px; }
    .modal-lite__footer{
      display:flex;
      justify-content:space-between;
      gap:10px;
      padding: 14px 16px;
      border-top: 1px solid rgba(17,24,39,.08);
      background: rgba(255,255,255,.92);
      backdrop-filter: blur(10px);
    }
    .modal-lite__grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 520px){
      .modal-lite__grid{ grid-template-columns: 1fr; }
    }
    .modal-lite__hint{
      margin-top: 10px;
      font-size: 12px;
      color: rgba(17,24,39,.62);
      line-height: 1.35;
    }
  </style>
</head>

<body>
  <a class="skip-link" href="#main">Saltar al contenido</a>

  <noscript>
    <div class="noscript" role="status" aria-live="polite">
      <strong>Necesitas JavaScript</strong> para ver y editar el horario.
    </div>
  </noscript>

  <!-- ================= HEADER (√öNICO) ================= -->
  <header class="topbar" role="banner">
    <div class="ssj2-sparks" aria-hidden="true"><i></i><i></i><i></i></div>

    <div class="brand" title="Musicala" aria-label="Horarios Grupales ¬∑ Musicala">
      <img
        src="./logo.png"
        alt="Musicala"
        class="logo"
        decoding="async"
        fetchpriority="high"
        width="44"
        height="44"
      />
      <div class="brand-text">
        <h1>Horarios Grupales</h1>
        <p>Tablero ¬∑ Lista ¬∑ d√≠a ¬∑ hora ¬∑ sal√≥n</p>
      </div>
    </div>

    <div class="actions" aria-label="Acciones">
      <!-- Estado -->
      <div id="results-info" class="results-info" aria-live="polite" aria-atomic="true">‚Äî</div>

      <button id="btn-reload" class="btn small" type="button" title="Recargar datos">
        Recargar
      </button>

      <button id="btn-export-json" class="btn small" type="button" title="Exportar JSON">
        Exportar
      </button>

      <button id="btn-import-json" class="btn small" type="button" title="Importar JSON">
        Importar
      </button>

      <button
        id="btn-fullscreen"
        class="btn small"
        type="button"
        title="Ver solo el tablero en pantalla completa"
        aria-label="Pantalla completa del tablero"
        aria-pressed="false"
      >Pantalla completa</button>

      <input
        id="file-import-json"
        class="sr-only"
        type="file"
        accept="application/json"
        aria-label="Seleccionar archivo JSON para importar"
      />
    </div>
  </header>

  <!-- ================= MAIN ================= -->
  <main class="container shell" id="main" role="main">
    <section class="workspace" aria-label="√Årea de trabajo">

      <!-- Sidebar izquierda -->
      <aside class="rail sidebar" id="sidebar" aria-label="Panel izquierdo">

        <!-- ================= FILTROS ================= -->
        <div class="panel rail-card" aria-label="Filtros">
          <div class="rail-title">
            <strong>Filtros</strong>
            <span>R√°pidos</span>
          </div>

          <div class="field">
            <label for="search">Buscar</label>
            <input
              id="search"
              type="search"
              placeholder="Ej: Piano, Urbano, Teens‚Ä¶"
              autocomplete="off"
              inputmode="search"
              aria-label="Buscar por nombre, edad, √°rea o enfoque"
            />
          </div>

          <!-- Vista -->
          <div class="rail-title" style="margin-top:10px;">
            <strong>Vista</strong><span>Modo</span>
          </div>
          <div class="color-controls" aria-label="Controles de vista">
            <div class="seg" role="group" aria-label="Tipo de vista">
              <label for="view-grid">
                <input type="radio" name="viewMode" id="view-grid" value="grid" checked />
                Tablero
              </label>
              <label for="view-list">
                <input type="radio" name="viewMode" id="view-list" value="list" />
                Lista
              </label>
            </div>
          </div>

          <div class="field">
            <label for="filter-clase">√Årea</label>
            <select id="filter-clase">
              <option value="">Todas</option>
            </select>
          </div>

          <div class="field">
            <label for="filter-edad">Edad / categor√≠a</label>
            <select id="filter-edad">
              <option value="">Todas</option>
            </select>
          </div>

          <div class="rail-title" style="margin-top:10px;">
            <strong>D√≠a</strong><span>Tabs</span>
          </div>
          <div id="day-tabs" class="day-tabs" role="tablist" aria-label="D√≠as"></div>

          <div class="rail-title" style="margin-top:10px;">
            <strong>Colores</strong><span>Modo</span>
          </div>
          <div class="color-controls" aria-label="Controles de color">
            <div class="seg" role="group" aria-label="Colorear por">
              <label for="color-by-area">
                <input type="radio" name="colorMode" id="color-by-area" value="area" checked />
                √Årea
              </label>
              <label for="color-by-age">
                <input type="radio" name="colorMode" id="color-by-age" value="age" />
                Edad
              </label>
            </div>
          </div>

          <div class="btn-group" style="margin-top:10px;">
            <div class="group-label">Utilidades</div>
            <div class="btn-row">
              <button id="btn-clear" class="btn small" type="button">Limpiar</button>
            </div>
          </div>
        </div>

        <!-- ================= LEYENDA ================= -->
        <div class="panel rail-card" aria-label="Leyenda">
          <div class="rail-title">
            <strong>Leyenda</strong>
            <span>√Åreas</span>
          </div>
          <div class="legend" aria-label="Leyenda de √°reas">
            <span class="legend-item music">M√∫sica</span>
            <span class="legend-item dance">Danza</span>
            <span class="legend-item theater">Teatro</span>
            <span class="legend-item arts">Artes</span>
            <span class="legend-item stim">Estimulaci√≥n</span>
            <span class="legend-item peak">Hora pico</span>
          </div>
        </div>

        <!-- ================= COMPAT: GRUPOS (OCULTO) ================= -->
        <div id="group-compat" aria-hidden="true">
          <label for="group-select">Grupo (compat)</label>
          <select id="group-select">
            <option value="">Todos los grupos</option>
          </select>

          <button id="btn-group-add" type="button">+ Grupo</button>
          <button id="btn-group-delete" type="button">Eliminar</button>

          <!-- Mini modal real -->
          <div id="group-modal" class="modal-lite" aria-hidden="true">
            <div class="modal-lite__backdrop" data-close="group-modal" aria-hidden="true"></div>

            <div class="modal-lite__card" role="dialog" aria-modal="true" aria-labelledby="group-modal-title">
              <div class="modal-lite__header">
                <strong id="group-modal-title">Crear grupo (r√°pido)</strong>
                <button id="group-modal-close" class="icon-btn" type="button" aria-label="Cerrar">‚úï</button>
              </div>

              <div class="modal-lite__body">
                <div class="modal-lite__grid">
                  <div class="field">
                    <label for="g-enfoque">Enfoque</label>
                    <input id="g-enfoque" placeholder="Ej: Piano, Urbano‚Ä¶" />
                  </div>

                  <div class="field">
                    <label for="g-edad">Edad</label>
                    <select id="g-edad">
                      <option value="">‚Äî</option>
                      <option>Musibabies</option>
                      <option>Musicalitos</option>
                      <option>Musikids</option>
                      <option>Musiteens</option>
                      <option>Musigrandes</option>
                      <option>Musiadultos</option>
                      <option>Todos</option>
                    </select>
                  </div>

                  <div class="field">
                    <label for="g-clase">√Årea</label>
                    <select id="g-clase">
                      <option value="">‚Äî</option>
                      <option>M√∫sica</option>
                      <option>Danza</option>
                      <option>Teatro</option>
                      <option>Artes pl√°sticas</option>
                      <option>Estimulaci√≥n Art√≠stica</option>
                    </select>
                  </div>
                </div>

                <div class="modal-lite__hint">
                  Esto crea el grupo sin horarios (luego lo abres y le agregas sesiones).
                </div>
              </div>

              <div class="modal-lite__footer">
                <button id="btn-group-modal-delete" class="btn" type="button" title="Eliminar el grupo seleccionado">
                  Eliminar seleccionado
                </button>
                <div style="display:flex; gap:10px;">
                  <button id="btn-group-modal-cancel" class="btn" type="button">Cancelar</button>
                  <button id="btn-group-modal-save" class="btn primary" type="button">Crear</button>
                </div>
              </div>
            </div>
          </div>
        </div>

      </aside>

      <!-- Centro -->
      <section class="center" aria-label="Horario">

        <!-- Tablero + Lista -->
        <section class="schedule-wrap" id="grid-wrap" aria-label="Tablero de horarios">
          <div
            class="schedule-scroll"
            role="region"
            aria-label="Horario con desplazamiento"
            tabindex="0"
          >
            <!-- GRID -->
            <div id="schedule-grid" class="schedule-grid" aria-label="Tablero (grid)"></div>

            <!-- LISTA -->
            <div id="schedule-list" class="schedule-list hidden" aria-label="Vista lista"></div>
          </div>
        </section>

        <!-- Stats debajo del tablero -->
        <section class="panel stats-card stats-below" aria-label="Estad√≠sticas" id="analyticsWrap">
          <div class="stats-head">
            <div class="stats-title">
              <strong id="analyticsTitle">Resumen + Distribuci√≥n</strong>
              <span id="analyticsSubtitle">Separado por d√≠a (activo) y semana (seg√∫n filtros).</span>
            </div>
          </div>

          <!--
            ‚úÖ Mantiene IDs existentes (NO rompe JS):
              - anaTopContent
              - anaBottomContent
              - anaAlertsContent
            ‚úÖ Agrega contenedor opcional para semana (anaWeekContent) sin tocar l√≥gica actual.
          -->
          <div class="analytics-simple analytics-pro" aria-label="Panel de anal√≠tica">

            <!-- HOY / D√çA ACTIVO (principal) -->
            <div class="stats-box span-2" aria-label="Resumen del d√≠a activo">
              <div class="stats-box-head">
                <h4 id="anaTopTitle">Hoy (d√≠a activo)</h4>
                <small class="muted">KPIs del d√≠a seleccionado en tabs.</small>
              </div>
              <div id="anaTopContent" class="stats-kpis stats-kpis--big"></div>
            </div>

            <!-- SEMANA (nuevo contenedor) -->
            <div class="stats-box" aria-label="Resumen semanal">
              <div class="stats-box-head">
                <h4 id="anaWeekTitle">Semana</h4>
                <small class="muted">Totales y picos (con filtros actuales).</small>
              </div>
              <!-- Vac√≠o por ahora: se llena cuando ajustemos horarios.core.js -->
              <div id="anaWeekContent" class="stats-kpis">
                <span class="kpi subtle">‚è≥ Pendiente: separador ‚ÄúSemana‚Äù (sin romper nada).</span>
              </div>
            </div>

            <!-- ALERTAS -->
            <div class="stats-box" aria-label="Alertas y recomendaciones">
              <div class="stats-box-head">
                <h4>Alertas</h4>
                <small class="muted">Se√±ales r√°pidas (choques, ocupaci√≥n, pico).</small>
              </div>
              <div id="anaAlertsContent" class="stats-alerts" aria-live="polite" aria-atomic="true"></div>
            </div>

            <!-- DISTRIBUCI√ìN / OCUPACI√ìN (mantiene id anaBottomContent) -->
            <div class="stats-box span-3" aria-label="Distribuci√≥n y ocupaci√≥n">
              <div class="stats-box-head">
                <h4 id="anaBottomTitle">Distribuci√≥n (semana)</h4>
                <small class="muted">Por d√≠a, arte, edad, salones y horas.</small>
              </div>
              <div id="anaBottomContent" class="stats-kpis"></div>
            </div>

          </div>

          <div class="sr-only" aria-hidden="true">
            <span id="stat-total-groups"></span>
            <span id="stat-total-sessions"></span>
            <span id="stat-total-rooms"></span>
          </div>
        </section>

        <footer class="mini-footer" aria-label="Pie">
          <small>
            Tip: click en celda vac√≠a para crear. Click en bloque para editar. Si te equivocas, el horario se venga. üòà
          </small>
        </footer>
      </section>
    </section>
  </main>

  <!-- ================= MODAL (editor de CLASES/BLOQUES) ================= -->
  <div id="modal" class="modal hidden" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="modal-title">
      <header class="modal-header">
        <h2 id="modal-title">Editar grupo</h2>
        <button id="modal-close" class="icon-btn" type="button" aria-label="Cerrar">‚úï</button>
      </header>

      <div class="modal-body">
        <div class="form-grid">
          <div class="field">
            <label for="m-clase">√Årea</label>
            <select id="m-clase">
              <option value="">‚Äî</option>
              <option>Danza</option>
              <option>Teatro</option>
              <option>M√∫sica</option>
              <option>Artes pl√°sticas</option>
              <option>Estimulaci√≥n Art√≠stica</option>
            </select>
          </div>

          <div class="field">
            <label for="m-edad">Edad / categor√≠a</label>
            <select id="m-edad">
              <option value="">‚Äî</option>
              <option>Musibabies</option>
              <option>Musicalitos</option>
              <option>Musikids</option>
              <option>Musiteens</option>
              <option>Musigrandes</option>
              <option>Musiadultos</option>
              <option>Todos</option>
            </select>
          </div>

          <div class="field">
            <label for="m-enfoque">Nombre / Enfoque</label>
            <input id="m-enfoque" placeholder="Ej: Piano, Urbano, Teatro musical‚Ä¶" />
          </div>

          <div class="field">
            <label for="m-nivel">Nivel</label>
            <input id="m-nivel" placeholder="Exploraci√≥n, B√°sico‚Ä¶" />
          </div>

          <div class="field">
            <label for="m-cupo-max">Cupo m√°ximo</label>
            <input id="m-cupo-max" type="number" min="0" inputmode="numeric" />
          </div>

          <div class="field">
            <label for="m-cupo-ocupado">Cupos ocupados</label>
            <input id="m-cupo-ocupado" type="number" min="0" inputmode="numeric" />
          </div>
        </div>

        <hr />

        <section class="sessions" aria-label="Horarios del grupo">
          <header class="sessions-head">
            <h3>Horarios (d√≠a ¬∑ hora ¬∑ sal√≥n)</h3>
            <button id="btn-add-session" class="btn small" type="button">+ Agregar horario</button>
          </header>

          <div id="sessions-list" class="sessions-list"></div>
        </section>
      </div>

      <footer class="modal-footer">
        <label class="checkbox" for="m-activo">
          <input type="checkbox" id="m-activo" />
          <span>Grupo activo</span>
        </label>

        <div class="modal-actions">
          <button id="btn-delete" class="btn" type="button">Eliminar</button>
          <button id="btn-save" class="btn primary" type="button">Guardar</button>
        </div>
      </footer>
    </div>
  </div>

  <div id="toast" class="toast" aria-live="polite" aria-atomic="true"></div>

  <!-- App -->
  <script type="module" src="./main.js"></script>
</body>
</html>

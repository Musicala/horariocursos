<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="color-scheme" content="light" />
  <meta name="theme-color" content="#ffffff" />

  <title>Horarios Grupales ¬∑ Musicala (LIGHT)</title>
  <meta name="description" content="Visor y editor de horarios grupales por d√≠a, hora y sal√≥n." />

  <meta name="robots" content="index,follow" />
  <meta name="format-detection" content="telephone=no" />

  <link rel="icon" href="./logo.png" />
  <link rel="apple-touch-icon" href="./logo.png" />

  <link rel="preconnect" href="https://www.gstatic.com" crossorigin />
  <link rel="preconnect" href="https://firestore.googleapis.com" crossorigin />

  <link rel="preload" href="./styles.css" as="style" />
  <link rel="stylesheet" href="./styles.css" />

  <!-- Utilitarios m√≠nimos (no ‚Äútema‚Äù, solo accesibilidad/soporte) -->
  <style>
    .hidden{ display:none !important; }
    .sr-only{
      position:absolute!important;
      width:1px;height:1px;
      padding:0;margin:-1px;
      overflow:hidden;clip:rect(0,0,0,0);
      white-space:nowrap;border:0;
    }

    /* Skip link */
    .skip-link{
      position:absolute; left:-9999px; top:auto;
      width:1px; height:1px; overflow:hidden;
    }
    .skip-link:focus{
      left:12px; top:12px;
      width:auto; height:auto;
      padding:10px 12px;
      background:#fff;
      border:1px solid rgba(17,24,39,.18);
      border-radius:12px;
      z-index:9999;
      box-shadow: 0 12px 30px rgba(17,24,39,.12);
    }

    button, .btn, .icon-btn { touch-action: manipulation; }

    .noscript{
      margin: 12px;
      padding: 12px 14px;
      border: 1px solid rgba(17,24,39,.12);
      border-radius: 14px;
      background: #fff;
      color:#111827;
      box-shadow: 0 12px 30px rgba(17,24,39,.06);
    }
  </style>
</head>

<body>
  <a class="skip-link" href="#main">Saltar al contenido</a>

  <noscript>
    <div class="noscript" role="status" aria-live="polite">
      <strong>Necesitas JavaScript</strong> para ver y editar el horario.
    </div>
  </noscript>

  <!-- ================= HEADER (√öNICO) ================= -->
  <header class="topbar" role="banner">
    <div class="ssj2-sparks" aria-hidden="true"><i></i><i></i><i></i></div>

    <div class="brand" title="Musicala" aria-label="Horarios Grupales ¬∑ Musicala">
      <img
        src="./logo.png"
        alt="Musicala"
        class="logo"
        decoding="async"
        fetchpriority="high"
        width="44"
        height="44"
      />
      <div class="brand-text">
        <h1>Horarios Grupales</h1>
        <p>Tablero ¬∑ Lista ¬∑ d√≠a ¬∑ hora ¬∑ sal√≥n</p>
      </div>
    </div>

    <div class="actions" aria-label="Acciones">
      <!-- Estado (antes estaba en page-head duplicado) -->
      <div id="results-info" class="results-info" aria-live="polite">‚Äî</div>

      <button id="btn-reload" class="btn small" type="button" title="Recargar datos">
        Recargar
      </button>

      <button id="btn-export-json" class="btn small" type="button" title="Exportar JSON">
        Exportar
      </button>

      <button id="btn-import-json" class="btn small" type="button" title="Importar JSON">
        Importar
      </button>

      <button
        id="btn-fullscreen"
        class="btn small"
        type="button"
        title="Ver solo el tablero en pantalla completa"
        aria-label="Pantalla completa del tablero"
        aria-pressed="false"
      >Pantalla completa</button>

      <input id="file-import-json" class="sr-only" type="file" accept="application/json" />
    </div>
  </header>

  <!-- ================= MAIN ================= -->
  <main class="container shell" id="main" role="main">
    <section class="workspace" aria-label="√Årea de trabajo">

      <!-- Sidebar izquierda -->
      <aside class="rail sidebar" id="sidebar" aria-label="Panel izquierdo">

        <div class="panel rail-card">
          <div class="rail-title">
            <strong>Grupo</strong>
            <span>Selector</span>
          </div>
          <div class="field">
            <label for="group-select">Selecciona un grupo</label>
            <select id="group-select">
              <option value="">Todos los grupos</option>
            </select>
          </div>
        </div>

        <div class="panel rail-card" aria-label="Filtros">
          <div class="rail-title">
            <strong>Filtros</strong>
            <span>R√°pidos</span>
          </div>

          <div class="field">
            <label for="search">Buscar</label>
            <input
              id="search"
              type="search"
              placeholder="Ej: Piano, Urbano, Teens‚Ä¶"
              autocomplete="off"
              inputmode="search"
              aria-label="Buscar por nombre, edad, √°rea o enfoque"
            />
          </div>

          <!-- Vista -->
          <div class="rail-title" style="margin-top:10px;">
            <strong>Vista</strong><span>Modo</span>
          </div>
          <div class="color-controls" aria-label="Controles de vista">
            <div class="seg" role="group" aria-label="Tipo de vista">
              <label for="view-grid">
                <input type="radio" name="viewMode" id="view-grid" value="grid" checked />
                Tablero
              </label>
              <label for="view-list">
                <input type="radio" name="viewMode" id="view-list" value="list" />
                Lista
              </label>
            </div>
          </div>

          <div class="field">
            <label for="filter-clase">√Årea</label>
            <select id="filter-clase">
              <option value="">Todas</option>
              <option value="M√∫sica">M√∫sica</option>
              <option value="Danza">Danza</option>
              <option value="Teatro">Teatro</option>
              <option value="Artes pl√°sticas">Artes pl√°sticas</option>
            </select>
          </div>

          <div class="field">
            <label for="filter-edad">Edad / categor√≠a</label>
            <select id="filter-edad">
              <option value="">Todas</option>
              <option>Musibabies</option>
              <option>Musicalitos</option>
              <option>Musikids</option>
              <option>Musiteens</option>
              <option>Musigrandes</option>
              <option>Musiadultos</option>
            </select>
          </div>

          <div class="rail-title" style="margin-top:10px;">
            <strong>D√≠a</strong><span>Tabs</span>
          </div>
          <div id="day-tabs" class="day-tabs" role="tablist" aria-label="D√≠as"></div>

          <div class="rail-title" style="margin-top:10px;">
            <strong>Colores</strong><span>Modo</span>
          </div>
          <div class="color-controls" aria-label="Controles de color">
            <div class="seg" role="group" aria-label="Colorear por">
              <label for="color-by-area">
                <input type="radio" name="colorMode" id="color-by-area" value="area" checked />
                √Årea
              </label>
              <label for="color-by-age">
                <input type="radio" name="colorMode" id="color-by-age" value="age" />
                Edad
              </label>
            </div>
          </div>

          <div class="btn-group" style="margin-top:10px;">
            <div class="group-label">Utilidades</div>
            <div class="btn-row">
              <button id="btn-clear" class="btn small" type="button">Limpiar</button>
            </div>
          </div>
        </div>

        <div class="panel rail-card" aria-label="Leyenda">
          <div class="rail-title">
            <strong>Leyenda</strong>
            <span>√Åreas</span>
          </div>
          <div class="legend" aria-label="Leyenda de √°reas">
            <span class="legend-item music">M√∫sica</span>
            <span class="legend-item dance">Danza</span>
            <span class="legend-item theater">Teatro</span>
            <span class="legend-item arts">Artes</span>
            <span class="legend-item peak">Hora pico</span>
          </div>
        </div>
      </aside>

      <!-- Centro -->
      <section class="center" aria-label="Horario">

        <!-- Tablero + Lista -->
        <section class="schedule-wrap" id="grid-wrap" aria-label="Tablero de horarios">
          <div
            class="schedule-scroll"
            role="region"
            aria-label="Horario con desplazamiento"
            tabindex="0"
          >
            <!-- GRID -->
            <div id="schedule-grid" class="schedule-grid" aria-label="Tablero (grid)"></div>

            <!-- LISTA -->
            <div id="schedule-list" class="schedule-list hidden" aria-label="Vista lista"></div>
          </div>
        </section>

        <!-- Stats debajo del tablero -->
        <section class="panel stats-card stats-below" aria-label="Estad√≠sticas" id="analyticsWrap">
          <div class="stats-head">
            <div class="stats-title">
              <strong id="analyticsTitle">Estad√≠sticas</strong>
              <span id="analyticsSubtitle">Resumen r√°pido seg√∫n filtros.</span>
            </div>
          </div>

          <div class="analytics-simple">
            <div class="stats-box">
              <h4 id="anaTopTitle">Resumen</h4>
              <div id="anaTopContent" class="stats-kpis"></div>
            </div>

            <div class="stats-box">
              <h4 id="anaBottomTitle">Ocupaci√≥n</h4>
              <div id="anaBottomContent" class="stats-kpis"></div>
            </div>

            <div class="stats-box">
              <h4>Alertas</h4>
              <div id="anaAlertsContent" class="stats-alerts" aria-live="polite" aria-atomic="true"></div>
            </div>
          </div>
        </section>

        <footer class="mini-footer" aria-label="Pie">
          <small>
            Tip: click en celda vac√≠a para crear. Click en bloque para editar. Si te equivocas, el horario se venga. üòà
          </small>
        </footer>
      </section>
    </section>
  </main>

  <!-- ================= MODAL (editor) ================= -->
  <!-- IMPORTANT√çSIMO: inicia oculto con .hidden para que NO aparezca de primeras -->
  <div id="modal" class="modal hidden" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="modal-title">
      <header class="modal-header">
        <h2 id="modal-title">Editar grupo</h2>
        <button id="modal-close" class="icon-btn" type="button" aria-label="Cerrar">‚úï</button>
      </header>

      <div class="modal-body">
        <div class="form-grid">
          <div class="field">
            <label for="m-clase">√Årea</label>
            <select id="m-clase">
              <option>Danza</option>
              <option>Teatro</option>
              <option>M√∫sica</option>
              <option>Artes pl√°sticas</option>
            </select>
          </div>

          <div class="field">
            <label for="m-edad">Edad / categor√≠a</label>
            <select id="m-edad">
              <option>Musibabies</option>
              <option>Musicalitos</option>
              <option>Musikids</option>
              <option>Musiteens</option>
              <option>Musigrandes</option>
              <option>Musiadultos</option>
            </select>
          </div>

          <div class="field">
            <label for="m-enfoque">Nombre / Enfoque</label>
            <input id="m-enfoque" placeholder="Ej: Piano, Urbano, Teatro musical‚Ä¶" />
          </div>

          <div class="field">
            <label for="m-nivel">Nivel</label>
            <input id="m-nivel" placeholder="Exploraci√≥n, B√°sico‚Ä¶" />
          </div>

          <div class="field">
            <label for="m-cupo-max">Cupo m√°ximo</label>
            <input id="m-cupo-max" type="number" min="0" inputmode="numeric" />
          </div>

          <div class="field">
            <label for="m-cupo-ocupado">Cupos ocupados</label>
            <input id="m-cupo-ocupado" type="number" min="0" inputmode="numeric" />
          </div>
        </div>

        <hr />

        <section class="sessions" aria-label="Horarios del grupo">
          <header class="sessions-head">
            <h3>Horarios (d√≠a ¬∑ hora ¬∑ sal√≥n)</h3>
            <button id="btn-add-session" class="btn small" type="button">+ Agregar horario</button>
          </header>

          <div id="sessions-list" class="sessions-list"></div>
        </section>
      </div>

      <footer class="modal-footer">
        <label class="checkbox" for="m-activo">
          <input type="checkbox" id="m-activo" />
          <span>Grupo activo</span>
        </label>

        <div class="modal-actions">
          <button id="btn-delete" class="btn" type="button">Eliminar</button>
          <button id="btn-save" class="btn primary" type="button">Guardar</button>
        </div>
      </footer>
    </div>
  </div>

  <div id="toast" class="toast" aria-live="polite" aria-atomic="true"></div>

  <!-- App -->
  <script type="module" src="./main.js"></script>
</body>
</html>
